# EAD7 開発引継ぎメモ

## 現在の進捗
- MK関連（生成・保存・復号・HMAC導出）はほぼ完成
- HMACKeyは MK --HKDF--> HMACKey の形で導出する方針に決定
- KID関連は IO（読み書き）部分が完成済み、生成処理はこれから
- 暗号化設計: 
  [magic:2B][ver:1B][alg:1B][mkid:1B][kid:16B][nonce:可変][ct][tag:16B]
- AEADは AES-256-GCM（AES-NIあれば高速）と XChaCha20-Poly1305 の2本立て
  → AES-NI非搭載環境でもソフト実装 fallback を検討
- JSONでは KID を b64u で表記、内部では常に BIN

## KID設計
- フィールド案:
  - label（ユーザー指定名）
  - kid（16Bランダム, JSONではb64u文字列）
  - created（作成日時）
  - status（鍵の状態）
  - note（任意の備考）

### status の候補
- active = 利用可能
- inactive = 無効化済み（論理削除、履歴保持）
- revoked = 信用失効（危険だから禁止）
- expired = 有効期限切れ

## 命名規則
- load*** 系 → JSONやファイルからデータを読み込む
- create*** 系 → 新規生成（MKやKID）
- 内部では BIN（SecByteBlock typedef）で統一

## 今後の課題
- KIDの生成関数実装（randomBINで16B乱数）
- KEK/DECとの結合処理（実際の暗号化・復号API）
- エラーハンドリングは基本 throw に統一
- ファイル暗号化やアイコン埋め込み（base64画像）は将来の拡張

---